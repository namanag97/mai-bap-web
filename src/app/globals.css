@import "tailwindcss";

@theme {
  /* ════════════════════════════════════════════════════════════
     DESIGN TOKENS — Single source of truth

     RULES:
     1. Components MUST use semantic tokens (surface-*, ink-*, border-*)
     2. The braun-* palette is PRIVATE — only referenced by semantic tokens
        and globals.css itself. Never use braun-* in component files.
     3. Never use text-white, bg-white, text-black, bg-black in components.
     4. Run `npm run lint:tokens` to verify compliance.
     ════════════════════════════════════════════════════════════ */

  /* ── Fonts ─────────────────────────────────────────────── */
  --font-sans: var(--font-geist-sans), ui-sans-serif, system-ui, sans-serif;
  --font-mono: var(--font-geist-mono), ui-monospace, monospace;

  /* ── Private Palette (DO NOT use in components) ────────── */
  --color-braun-50: #f5f3ef;
  --color-braun-100: #eceae5;
  --color-braun-200: #ddd9d3;
  --color-braun-300: #c5c0ba;
  --color-braun-400: #b5b0aa;
  --color-braun-500: #8a8580;
  --color-braun-600: #4a4744;
  --color-braun-700: #33302e;
  --color-braun-800: #1e1d1b;
  --color-braun-900: #1a1918;
  --color-braun-orange: #c2571a;

  /* ── Surfaces ──────────────────────────────────────────── */
  /* bg-surface-ground  — page background, default surface    */
  /* bg-surface-raised  — cards, dropdowns, elevated content  */
  /* bg-surface-inset   — alternate sections, code blocks     */
  /* bg-surface-overlay — glassmorphic nav, modals            */
  /* bg-surface-inverse — dark sections (Stats, CTA)          */
  --color-surface-ground: #f5f3ef;
  --color-surface-raised: #faf9f7;
  --color-surface-inset: #eceae5;
  --color-surface-deep: #e5e2dc;
  --color-surface-overlay: #faf9f7cc;
  --color-surface-inverse: #1a1918;

  /* ── Ink (text colors) ─────────────────────────────────── */
  /* text-ink-primary   — headings, strong text               */
  /* text-ink-secondary — body paragraphs                     */
  /* text-ink-muted     — captions, secondary info            */
  /* text-ink-dim       — placeholders, disabled              */
  /* text-ink-inverse   — text on dark/inverse surfaces       */
  /* text-ink-accent    — interactive highlights, links        */
  --color-ink-primary: #1a1918;
  --color-ink-secondary: #4a4744;
  --color-ink-muted: #8a8580;
  --color-ink-dim: #b5b0aa;
  --color-ink-inverse: #f5f3ef;
  --color-ink-accent: #c2571a;

  /* ── Borders ───────────────────────────────────────────── */
  /* border-border-default — standard borders                 */
  /* border-border-subtle  — very light separators            */
  /* border-border-strong  — emphasis, focus rings            */
  /* border-border-heavy   — structural lines, section weight */
  --color-border-default: #1a19181a;
  --color-border-subtle: #1a19180d;
  --color-border-strong: #1a191833;
  --color-border-heavy: #1a191859;

  /* ── Data / status colors ──────────────────────────────── */
  --color-data-positive: #059669;
  --color-data-warning: #d97706;
  --color-data-negative: #e11d48;
  --color-data-violet: #7c3aed;

  /* ── Radius ────────────────────────────────────────────── */
  --radius: 4px;
  --radius-sm: 2px;
  --radius-lg: 8px;

  /* ── Typography scale ──────────────────────────────────── */
  --text-display:    clamp(2.618rem, 7vw, 4.236rem);   /* fluid φ²→φ³ */
  --text-title1:     2.058rem;     /* φ × √φ */
  --text-title2:     1.618rem;     /* φ¹ */
  --text-title3:     1.272rem;     /* √φ */
  --text-title:      1.618rem;     /* alias → title2 */
  --text-heading:    1.128rem;     /* φ^0.25 */
  --text-body:       1rem;
  --text-subheading: 0.887rem;     /* 1/φ^0.25 */
  --text-callout:    0.942rem;     /* 1/φ^0.125 */
  --text-label:      0.835rem;     /* derived */
  --text-caption:    0.786rem;     /* 1/√φ */
  --text-meta:       0.618rem;     /* 1/φ */
  --text-micro:      0.5rem;       /* keep */
  --text-code:       0.8125rem;    /* keep (fixed) */

  /* ── Line heights ──────────────────────────────────────── */
  /* Law: as size increases, leading must decrease.           */
  --leading-display: 1.128;   /* φ^0.25 (was 0.92) */
  --leading-tight:   1.128;   /* φ^0.25 (was 1.1) */
  --leading-heading: 1.272;   /* √φ (was 1.2) */
  --leading-snug:    1.272;   /* √φ (was 1.4) */
  --leading-body:    1.618;   /* φ (was 1.65) */
  --leading-relaxed: 1.618;   /* φ (was 1.7) */
  --leading-mono:    1.272;   /* √φ (was 1.5) */

  /* ── Letter spacing ────────────────────────────────────── */
  --tracking-tight:   -0.01em;
  --tracking-normal:   0;
  --tracking-wide:     0.05em;
  --tracking-widest:   0.1em;
  --tracking-logo:     0.2em;
  --tracking-display: -0.022em;   /* display headings */
  --tracking-heading: -0.014em;   /* headings */
  --tracking-body:    -0.011em;   /* body */
  --tracking-label:    0.0618em;  /* uppercase labels (1/φ × 0.1em) */

  /* ── Spacing scale ─────────────────────────────────────── */
  --spacing-2xs: 0.382rem;    /* φ^-2 = 6.1px */
  --spacing-xs:  0.618rem;    /* φ^-1 = 9.9px */
  --spacing-sm:  1rem;        /* φ^0 = 16px */
  --spacing-md:  1.618rem;    /* φ^1 = 25.9px */
  --spacing-lg:  2.618rem;    /* φ^2 = 41.9px */
  --spacing-xl:  4.236rem;    /* φ^3 = 67.8px */
  --spacing-2xl: 6.854rem;    /* φ^4 = 109.6px */
  --spacing-3xl: 11.09rem;    /* φ^5 = 177.4px */

  /* Semantic space tokens */
  --space-section:    6.854rem;    /* φ^4 = 109.6px */
  --space-section-lg: 11.09rem;   /* φ^5 = 177.4px */
  --space-block:      4.236rem;    /* φ^3 = 67.8px */
  --space-element:    1.618rem;    /* φ^1 = 25.9px */
  --space-inline:     0.618rem;    /* φ^-1 = 9.9px */
  --space-gutter:     1.618rem;    /* φ^1 = 25.9px */

  /* ── Shadows (warm-tinted, actually visible) ──────────── */
  --shadow-xs: 0 1px 2px #1a19180d;
  --shadow-sm: 0 1px 3px #1a19181a, 0 1px 2px #1a19180d;
  --shadow-md: 0 4px 6px #1a19181a, 0 2px 4px #1a191810;
  --shadow-lg: 0 10px 15px #1a19181a, 0 4px 6px #1a191810;

  /* ── Z-index ─────────────────────────────────────────── */
  --z-base: 0;
  --z-raised: 1;
  --z-dropdown: 100;
  --z-sticky: 200;
  --z-overlay: 300;
  --z-modal: 400;
  --z-toast: 500;

  /* ── Interactive state overlays ───────────────────────── */
  --color-state-hover: #1a191808;
  --color-state-active: #1a191812;

  /* ── Status color backgrounds & borders ──────────────── */
  --color-data-positive-bg: #05966912;
  --color-data-positive-border: #05966926;
  --color-data-warning-bg: #d9770612;
  --color-data-warning-border: #d9770626;
  --color-data-negative-bg: #e11d4812;
  --color-data-negative-border: #e11d4826;
  --color-data-violet-bg: #7c3aed12;
  --color-data-violet-border: #7c3aed26;
  --color-data-accent-bg: #c2571a12;
  --color-data-accent-border: #c2571a26;

  /* ── Layout ──────────────────────────────────────────── */
  --navbar-height: 3.5rem;
  --sidebar-width: 16rem;

  /* ── Transitions ───────────────────────────────────────── */
  --ease-default: cubic-bezier(0.25, 0.1, 0.25, 1);
  --ease-in: cubic-bezier(0.4, 0, 1, 1);
  --ease-out: cubic-bezier(0, 0, 0.2, 1);
  --duration-fast: 120ms;
  --duration-base: 200ms;
  --duration-slow: 350ms;

  /* ── Opacity ─────────────────────────────────────────── */
  --opacity-disabled: 0.5;
  --opacity-overlay: 0.8;
}

/* ── Color-math derivations ────────────────────────────────────
   Borders and state overlays derive from a single --color-ink-base.
   @theme keeps hex values for Tailwind utility generation; these
   :root overrides win at runtime via cascade order (later = wins).
   In dark mode only --color-ink-base needs to change — all borders
   and states update automatically through the color-mix() functions.
   ─────────────────────────────────────────────────────────────── */
:root {
  --color-ink-base: #1a1918;
  --color-border-default: color-mix(in srgb, var(--color-ink-base) 10%, transparent);
  /* φ-scale derived constants */
  --phi: 1.618;
  --phi-half: 1.272;      /* √φ */
  --phi-quarter: 1.128;   /* φ^0.25 */
  --phi-eighth: 1.062;    /* φ^0.125 */
  --display-offset: calc(4.236rem * calc(1.128 / 1.618));
  --heading-offset: calc(1.128rem * calc(1.272 / 1.618));
  --body-offset: calc(1rem / 1.618);
  --color-border-subtle:  color-mix(in srgb, var(--color-ink-base) 5%,  transparent);
  --color-border-strong:  color-mix(in srgb, var(--color-ink-base) 20%, transparent);
  --color-border-heavy:   color-mix(in srgb, var(--color-ink-base) 35%, transparent);
  --color-state-hover:    color-mix(in srgb, var(--color-ink-base) 4%,  transparent);
  --color-state-active:   color-mix(in srgb, var(--color-ink-base) 8%,  transparent);
}

/* ── Reset ─────────────────────────────────────────────────── */
*,
*::before,
*::after {
  box-sizing: border-box;
}

html {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  scroll-behavior: smooth;
  scroll-padding-top: 4rem;
}

body {
  background-color: var(--color-surface-ground);
  color: var(--color-ink-primary);
}

/* Noise texture — single fixed overlay on body::after prevents stacking
   artifacts when multiple surfaces overlap. pointer-events: none lets all
   clicks pass through. z-index above everything keeps grain uniform. */
body::after {
  content: "";
  position: fixed;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
}

::selection {
  background-color: var(--color-ink-primary);
  color: var(--color-surface-ground);
}

:focus-visible {
  /* macOS/Linear-style focus ring: 2px surface-ground gap + 4px accent ring.
     box-shadow respects border-radius. No outline to override. */
  outline: none;
  box-shadow:
    0 0 0 2px var(--color-surface-ground),
    0 0 0 4px var(--color-ink-primary);
}

/* ── Scrollbar ─────────────────────────────────────────────── */
::-webkit-scrollbar {
  width: 5px;
  height: 5px;
}
::-webkit-scrollbar-track {
  background: transparent;
}
::-webkit-scrollbar-thumb {
  background: var(--color-border-default);
}
::-webkit-scrollbar-thumb:hover {
  background: var(--color-border-strong);
}

/* ══════════════════════════════════════════════════════════
   ARTICLE TYPOGRAPHY — editorial page-level elements
   ══════════════════════════════════════════════════════════ */

/* Article title — scales from ~30px mobile to ~52px large screen */
.article-title {
  font-size: clamp(1.875rem, 4.5vw, 3.25rem);
  font-weight: 300;
  letter-spacing: -0.02em;
  line-height: 1.05;
  color: var(--color-ink-primary);
  text-wrap: balance;
}

/* Article deck — the subtitle/excerpt under the title */
.article-deck {
  font-size: clamp(0.9375rem, 1.5vw, 1.0625rem);
  font-weight: 300;
  line-height: 1.75;
  color: var(--color-ink-secondary);
}

/* Article byline — single flowing line: author · role · date · readtime */
.article-byline {
  font-family: var(--font-mono), ui-monospace, monospace;
  font-size: 0.6875rem;
  letter-spacing: 0.04em;
  color: var(--color-ink-muted);
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 0.5rem;
  line-height: 1;
  /* Tabular + lining numerals: dates/times never jitter as values change */
  font-feature-settings: "tnum" on, "lnum" on;
  font-variant-numeric: tabular-nums;
}

/* The author's name — sans-serif, slightly heavier, primary colour */
.article-byline-name {
  font-family: var(--font-sans), ui-sans-serif, sans-serif;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--color-ink-primary);
  letter-spacing: 0;
}

/* Small square initial mark beside the name */
.article-byline-mark {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 1.5rem;
  height: 1.5rem;
  background-color: var(--color-surface-inverse);
  color: var(--color-ink-inverse);
  font-family: var(--font-mono), monospace;
  font-size: 0.5625rem;
  font-weight: 700;
  user-select: none;
  flex-shrink: 0;
}

/* Separator dot between byline segments */
.article-byline-sep {
  color: var(--color-ink-dim);
  user-select: none;
}

/* ══════════════════════════════════════════════════════════
   PROSE — long-form reading typography (blog + docs)
   All visual decisions live here. ProseRenderer = pure HTML structure.
   ══════════════════════════════════════════════════════════ */

.prose {
  color: var(--color-ink-secondary);
  font-size: clamp(1rem, 1.4vw, 1.125rem);
  line-height: var(--leading-body);
  max-width: 65ch;
}

/* Vertical rhythm — space between all direct children */
.prose > * + * {
  margin-top: 1.5em;
}

/* Lead paragraph — opening of an article, slightly larger + lighter */
.prose .prose-lead {
  font-size: clamp(1.0625rem, 1.6vw, 1.25rem);
  font-weight: 300;
  line-height: 1.75;
  color: var(--color-ink-secondary);
  margin-top: 0;
}

/* H2 — major section heading */
.prose h2 {
  font-size: clamp(1.125rem, 1.6vw, 1.375rem);
  font-weight: 600;
  color: var(--color-ink-primary);
  letter-spacing: -0.015em;
  border-bottom: 1px solid var(--color-border-default);
  padding-bottom: 0.625rem;
  margin-top: 3.5rem;
  margin-bottom: 1.5rem;
  line-height: var(--leading-heading);
  text-wrap: balance;
}

/* H3 — subsection heading, same size as body but heavier */
.prose h3 {
  font-size: clamp(0.9375rem, 1.15vw, 1rem);
  font-weight: 600;
  color: var(--color-ink-primary);
  margin-top: 2.25rem;
  margin-bottom: 0.625rem;
  line-height: var(--leading-heading);
  text-wrap: balance;
}

/* H4 — minor label, mono uppercase (like a section annotation) */
.prose h4 {
  font-family: var(--font-mono), ui-monospace, monospace;
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--color-ink-muted);
  margin-top: 2rem;
  margin-bottom: 0.5rem;
}

/* Paragraph */
.prose p {
  margin-bottom: 0;
  color: var(--color-ink-secondary);
  text-wrap: pretty; /* Modern: prevents single-word orphans on last line */
}

/* Editorial links — animated underline-fill reveal on hover */
.prose a {
  color: var(--color-ink-primary);
  text-decoration: none;
  /* The gradient starts as a 1px underline, expands to full height on hover */
  background-image: linear-gradient(var(--color-ink-primary), var(--color-ink-primary));
  background-position: 0% 100%;
  background-repeat: no-repeat;
  background-size: 100% 1px;
  transition:
    background-size var(--duration-fast) var(--ease-out),
    color var(--duration-fast) var(--ease-out);
}
.prose a:hover {
  background-size: 100% 100%;
  color: var(--color-ink-inverse);
}

/* Images and video — rounded object treatment with hairline border */
.prose img,
.prose video {
  border-radius: var(--radius-lg);
  box-shadow: 0 0 0 1px var(--color-border-subtle);
  transition:
    opacity var(--duration-base) var(--ease-default),
    filter var(--duration-base) var(--ease-default);
}

/* Dark mode: dim bright content so it doesn't hurt eyes in a dark room */
[data-theme="dark"] .prose img,
[data-theme="dark"] .prose video {
  opacity: 0.88;
  filter: brightness(0.9) contrast(1.05);
}
/* Hover restores full fidelity */
[data-theme="dark"] .prose img:hover,
[data-theme="dark"] .prose video:hover {
  opacity: 1;
  filter: brightness(1) contrast(1);
}

/* Unordered list — em-dash bullets */
.prose ul {
  padding-left: 1.5rem;
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 0.625rem;
}

.prose ul li {
  position: relative;
  color: var(--color-ink-secondary);
  line-height: var(--leading-body);
}

.prose ul li::before {
  content: "—";
  position: absolute;
  left: -1.5rem;
  top: -0.05em; /* Optical alignment: nudges dash to visual center of text baseline */
  color: var(--color-ink-dim);
  font-family: var(--font-mono), monospace;
}

/* Blockquote — editorial pull quote */
.prose blockquote {
  border-left: 2px solid var(--color-border-strong);
  padding-left: 1.5rem;
  padding-top: 0.125rem;
  padding-bottom: 0.125rem;
  margin-top: 2rem;
  margin-bottom: 2rem;
}

.prose blockquote p {
  font-style: italic;
  font-size: clamp(0.9375rem, 1.3vw, 1.0625rem);
  color: var(--color-ink-secondary);
  line-height: 1.7;
}

.prose blockquote footer {
  margin-top: 0.75rem;
  font-family: var(--font-mono), ui-monospace, monospace;
  font-size: 0.625rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--color-ink-muted);
  font-style: normal;
}

/* HR / divider */
.prose hr {
  height: 1px;
  background-color: var(--color-border-default);
  border: none;
  margin-top: 3rem;
  margin-bottom: 3rem;
}

/* Inline code */
.prose :not(pre) > code {
  background: var(--color-surface-inset);
  border: 1px solid var(--color-border-default);
  padding: 0.125em 0.375em;
  font-size: 0.8125rem;
  color: var(--color-ink-primary);
  font-family: var(--font-mono), monospace;
}

/* Pre / code blocks (fallback for non-CodeBlock usage) */
.prose pre {
  background: var(--color-surface-inverse);
  color: var(--color-ink-inverse);
  padding: 1.25rem 1.5rem;
  overflow-x: auto;
  font-size: 0.8125rem;
  line-height: var(--leading-mono);
  border-radius: var(--radius-lg);
  /* Inset highlight + outer shadow in one declaration — eliminates the need
     for a border while delivering a premium embedded-object feel */
  box-shadow:
    inset 0 0 0 1px rgba(255, 255, 255, 0.07),
    inset 0 1px 0 rgba(255, 255, 255, 0.1),
    var(--shadow-md);
  /* Bleed slightly wider than the reading column — looks premium on blog posts */
  margin-left: -1.5rem;
  margin-right: -1.5rem;
  margin-top: 2.5rem;
  margin-bottom: 2.5rem;
}

.prose pre code {
  color: inherit;
  font-size: inherit;
  font-family: var(--font-mono), monospace;
}

/* ── Smooth transitions ───────────────────────────────────── */
@media (prefers-reduced-motion: no-preference) {
  @view-transition {
    navigation: auto;
  }
}

/* ── Dark mode ──────────────────────────────────────────────── */
[data-theme="dark"] {
  /* Private palette inversion */
  --color-braun-50: #141312;
  --color-braun-100: #1e1d1b;
  --color-braun-200: #252320;
  --color-braun-300: #33302e;
  --color-braun-400: #5a5550;
  --color-braun-500: #8a8580;
  --color-braun-600: #c5c0ba;
  --color-braun-700: #ddd9d3;
  --color-braun-800: #eceae5;
  --color-braun-900: #f5f3ef;
  --color-braun-orange: #c2571a;

  /* Semantic token overrides — shifted toward deep tungsten for OLED clarity
     (less brown, more neutral) while keeping a whisper of warm tint */
  --color-surface-ground: #0a0a09;
  --color-surface-raised: #121211;
  --color-surface-inset: #1a1a18;
  --color-surface-deep: #1c1c1a;
  --color-surface-overlay: rgba(10, 10, 9, 0.85);
  --color-surface-inverse: #f5f3ef;

  --color-ink-primary: #f5f3ef;
  --color-ink-secondary: #c5c0ba;
  --color-ink-muted: #8a8580;
  --color-ink-dim: #5a5550;
  --color-ink-inverse: #1a1918;
  /* Accent is more luminous in dark mode so orange pops on near-black */
  --color-ink-accent: #e56b25;

  /* Single base flip — all borders and states derive automatically
     via the color-mix() :root block above. No rgba management needed. */
  --color-ink-base: #f5f3ef;

  /* Shadows — deeper for dark mode */
  --shadow-xs: 0 1px 2px #00000026;
  --shadow-sm: 0 1px 3px #00000033, 0 1px 2px #0000001a;
  --shadow-md: 0 4px 6px #00000033, 0 2px 4px #00000026;
  --shadow-lg: 0 10px 15px #00000033, 0 4px 6px #00000026;

  /* Status bg/border — slightly higher alpha for dark */
  --color-data-positive-bg: #05966918;
  --color-data-positive-border: #05966930;
  --color-data-warning-bg: #d9770618;
  --color-data-warning-border: #d9770630;
  --color-data-negative-bg: #e11d4818;
  --color-data-negative-border: #e11d4830;
  --color-data-violet-bg: #7c3aed18;
  --color-data-violet-border: #7c3aed30;
  --color-data-accent-bg: #c2571a18;
  --color-data-accent-border: #c2571a30;
}

/* Dark mode surface raised elements */
[data-theme="dark"] .bg-surface-raised {
  background-color: var(--color-surface-raised);
}

/* ── Hover-lift utility ────────────────────────────────────── */
.hover-lift {
  /* Spring-like cubic-bezier: starts fast, decelerates gracefully.
     Separate durations let shadow expand softer than the physical lift. */
  transition:
    box-shadow 300ms cubic-bezier(0.2, 0, 0, 1),
    transform 300ms cubic-bezier(0.2, 0, 0, 1),
    border-color 300ms cubic-bezier(0.2, 0, 0, 1);
  will-change: transform;
}
.hover-lift:hover {
  box-shadow:
    inset 0 0 0 1px var(--color-border-strong),
    0 12px 24px -8px color-mix(in srgb, var(--color-ink-primary) 15%, transparent);
  transform: translateY(-2px);
}

/* ── Engineering grid — subtle single-scale, barely visible ── */
.bg-engineering-grid {
  background-image:
    linear-gradient(var(--color-border-subtle) 1px, transparent 1px),
    linear-gradient(90deg, var(--color-border-subtle) 1px, transparent 1px);
  background-size: 80px 80px;
}

/* ═══════════════════════════════════════════════════════════
   LAYER 3 — COMPONENT CLASSES
   Change here → every instance on the site updates.
   Components just apply the class name, zero styling decisions.
   ═══════════════════════════════════════════════════════════ */

/* ── Card — standalone elevated content block ─────────────── */
.card {
  padding: var(--space-element);
  border-radius: var(--radius);
  background-color: var(--color-surface-raised);
  border: 1px solid var(--color-border-default);
  box-shadow: var(--shadow-sm);
}

/* ── Card grid — group of cells elevated as a unit ────────── */
/* Container: shows border-color through gap-px as grid lines  */
/* Usage: <div class="card-grid grid gap-px">                 */
.card-grid {
  background-color: var(--color-border-default);
  border: 1px solid var(--color-border-default);
  box-shadow: var(--shadow-sm);
}

/* ── Card grid cell — individual cell within a card-grid ──── */
.card-grid-cell {
  background-color: var(--color-surface-raised);
}

/* ── Card featured — pricing highlight card, warm paper emphasis ── */
.card-featured {
  padding: var(--space-element);
  border-radius: var(--radius);
  background-color: var(--color-surface-inset);
  border: 1px solid var(--color-border-strong);
  box-shadow: var(--shadow-md);
  border-top: 2px solid var(--color-ink-primary);
}

/* ── Section — full-width content section ─────────────────── */
.section {
  padding-top: var(--space-section);
  padding-bottom: var(--space-section);
  border-bottom: 1px solid var(--color-border-default);
  background-color: var(--color-surface-ground);
}

/* ── Section inverse — dark full-width section ────────────── */
.section-inverse {
  padding-top: var(--space-section);
  padding-bottom: var(--space-section);
  border-bottom: 1px solid var(--color-border-default);
  background-color: var(--color-surface-inverse);
}

/* ── Section deep — weighted warm section, replaces dark for stats/CTA ── */
.section-deep {
  padding-top: var(--space-section);
  padding-bottom: var(--space-section);
  background-color: var(--color-surface-deep);
  border-top: 2px solid var(--color-border-strong);
  border-bottom: 1px solid var(--color-border-default);
}

/* ── Typography component classes ─────────────────────────── */

/* Section title — large light heading */
.section-title {
  font-size: clamp(1.875rem, 3vw, 2.25rem);
  font-weight: 300;
  letter-spacing: -0.01em;
  line-height: 1.1;
  color: var(--color-ink-primary);
}

/* Meta label — tiny mono uppercase label (default: muted) */
.meta-label {
  font-family: var(--font-mono), ui-monospace, monospace;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  font-size: 10px;
  color: var(--color-ink-muted);
  font-feature-settings: "tnum" on, "lnum" on;
  font-variant-numeric: tabular-nums;
}
.meta-label-xxs {
  font-size: 9px;
}
.meta-label-dim {
  color: var(--color-ink-dim);
}

/* Section label — "01 —— CAPABILITIES" numbered index pattern */
.section-label-index {
  font-family: var(--font-mono), ui-monospace, monospace;
  font-size: 10px;
  color: var(--color-ink-muted);
  font-variant-numeric: tabular-nums;
}
.section-label-rule {
  height: 1px;
  width: 1.5rem;
  background-color: var(--color-border-default);
  display: inline-block;
}

/* Form label */
.form-label {
  font-size: 0.75rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-ink-primary);
  margin-bottom: 0.375rem;
  display: block;
}

/* Divider — horizontal rule */
.divider {
  height: 1px;
  background-color: var(--color-border-default);
}

/* ── Badge pill — category/status tag ─────────────────────── */
.badge-pill {
  display: inline-flex;
  align-items: center;
  padding: 0.25em 0.75em;
  border-radius: 9999px;
  font-family: var(--font-mono), monospace;
  font-size: 0.6875rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  white-space: nowrap;
  background: var(--color-surface-raised);
  box-shadow: inset 0 0 0 1px var(--color-border-default);
  color: var(--color-ink-secondary);
}

/* ── Reading progress bar — pure CSS scroll timeline ──────── */
@supports (animation-timeline: scroll()) {
  .reading-progress {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: var(--color-ink-accent);
    transform-origin: 0% 50%;
    animation: scale-reading-progress auto linear;
    animation-timeline: scroll(root block);
    z-index: var(--z-sticky);
  }
  @keyframes scale-reading-progress {
    0% { transform: scaleX(0); }
    100% { transform: scaleX(1); }
  }
}

/* ── Sticky table of contents sidebar ─────────────────────── */
.toc-sidebar {
  position: sticky;
  top: calc(var(--navbar-height) + 2rem);
  max-height: calc(100vh - var(--navbar-height) - 4rem);
  overflow-y: auto;
  /* Fade list out at the bottom to hint at scrollability */
  mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
  -webkit-mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
}

.toc-link {
  display: block;
  padding: 0.25rem 0.75rem;
  font-size: 0.8125rem;
  line-height: 1.5;
  color: var(--color-ink-muted);
  text-decoration: none;
  transition:
    color var(--duration-fast) var(--ease-out),
    box-shadow var(--duration-fast) var(--ease-out);
}

.toc-link[data-active="true"] {
  color: var(--color-ink-primary);
  font-weight: 500;
  /* Animated left-border inset for the active section */
  box-shadow: inset 2px 0 0 0 var(--color-ink-accent);
}

/* ASCII diagram — embedded object treatment with inset box, not raw text */
.prose-diagram {
  font-family: var(--font-mono), ui-monospace, monospace;
  font-size: 0.8125rem;
  line-height: 1.5;
  letter-spacing: 0;
  white-space: pre;
  color: var(--color-ink-secondary);
  display: block;
  background: var(--color-surface-inset);
  padding: 2rem;
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-border-subtle);
  overflow-x: auto;
  margin-top: 2rem;
  margin-bottom: 2rem;
}

/* Inline diagram — no box, no background, no border.
   Pure mono text indented from the left margin. Feels like the text itself.
   The only distinction is the typeface (mono) and a small left indent. */
.prose-diagram-inline {
  font-family: var(--font-mono), ui-monospace, monospace;
  font-size: 0.875rem;
  line-height: 1.65;
  letter-spacing: 0;
  white-space: pre;
  color: var(--color-ink-secondary);
  display: block;
}

/* ── TOC Tickers — fixed left-side section indicators ─────── */
/*
 * Visible only at xl+ (≥1280px). Each ticker is a tiny dot
 * connected by a 1px vertical line. The active dot bounces.
 * All transitions use the project's spring cubic-bezier.
 */
.toc-tickers {
  display: none;
}

@media (min-width: 1280px) {
  .toc-tickers {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
    position: fixed;
    left: 1.25rem;
    top: 50%;
    transform: translateY(-50%);
    z-index: var(--z-raised);
    /* Fade-in driven by JS opacity toggle */
    transition: opacity 350ms cubic-bezier(0.2, 0, 0, 1);
    pointer-events: auto;
  }
}

/* Vertical connecting line behind the dots */
.toc-tickers-line {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 1px;
  background-color: var(--color-border-subtle);
  pointer-events: none;
}

/* Each dot */
.toc-ticker-dot {
  position: relative;
  z-index: 1;
  width: 5px;
  height: 5px;
  border-radius: 9999px;
  background-color: var(--color-ink-muted);
  opacity: 0.18;
  border: none;
  padding: 0;
  cursor: pointer;
  transition:
    opacity 350ms cubic-bezier(0.2, 0, 0, 1),
    transform 350ms cubic-bezier(0.2, 0, 0, 1),
    background-color 350ms cubic-bezier(0.2, 0, 0, 1);
  /* Enlarge hit target without changing visual size */
  outline: none;
}
.toc-ticker-dot::before {
  content: '';
  position: absolute;
  inset: -6px;
}
.toc-ticker-dot:hover {
  opacity: 0.4;
  transform: scale(1.5);
}

/* Active state — bounces into view */
.toc-ticker-dot--active {
  background-color: var(--color-ink-primary);
  opacity: 0.6;
  animation: ticker-bounce 400ms cubic-bezier(0.2, 0, 0, 1) forwards;
}

@keyframes ticker-bounce {
  0%   { transform: scale(1)   translateY(0); }
  40%  { transform: scale(2.0) translateY(-2px); }
  70%  { transform: scale(1.6) translateY(-1px); }
  100% { transform: scale(1.75) translateY(-1px); }
}

/* Dark mode adjustments for tickers */
[data-theme="dark"] .toc-ticker-dot--active {
  background-color: var(--color-ink-primary);
}

/* Grain is far more visible on near-black — halve the opacity in dark mode */
[data-theme="dark"] body::after {
  opacity: 0.4;
}

/* Dark prose adjustments */
[data-theme="dark"] .prose pre {
  background: var(--color-surface-inset);
  border-color: var(--color-border-default);
}
